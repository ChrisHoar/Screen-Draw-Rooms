@page
@using ScreenDraw.Interfaces
@using Microsoft.Extensions.Logging;
@inject IList<IColourListItem> ColourValues
@inject ISketchRooms sketchRooms
@inject ILogger<SketchRoomModel> logger;
@{
    var roomName = string.Empty;
    var artistName = string.Empty;
    object currentImage = null;

    try
    {
        if (Request.QueryString.HasValue == true)
        {
            roomName = Request.Query["RoomName"];
            artistName = Request.Query["ArtistName"];
        }
        currentImage = sketchRooms.Rooms.Where(r => r.Name == roomName).FirstOrDefault().CurrentImage;
    }
    catch (Exception ex)
    {
        logger.LogError(ex.Message);
    }

}

<div style="position: absolute; left: 5px; top: 5px; font-size:large;">
    <label>Select Colour</label>
    <select id="colours">
        @{
            foreach (IColourListItem item in ColourValues)
            {
                @:<option value="@item.Value ">
                    @item.Text
                @:</option>
            }
        }
    </select>

    <input type="button" onclick="clearCanvas();" value="Clear Canvas" />

</div>

 @*
     Temporary image used to add the current state of the image in the room to new users entering the room.
     The SetImage function adds it to the canvas. The currentImage is data held in the room
     instance, and is passed back in the DrawHub each time a user stops drawing.
     This image is hidden once teh canvas is updated
 *@

<img src="@currentImage" id="currentImage" style=" position: absolute; top: 40px; left: 5px" width="350" height="550" />

<canvas data="" id="canvas" style="border: solid 1px blue; position: absolute; top: 40px; left: 5px" width="350" height="550">
</canvas>

<div>
    <input type="hidden" id="roomName" value="@roomName" />
</div>




<script src="~/js/signalr/dist/browser/signalr.js"></script>
<script src="~/js/draw.js"></script>
<script>window.onload = SetImage();


    function SetImage() {
        var context = canvas.getContext('2d');

        var img = document.getElementById("currentImage");

        context.drawImage(img, 0, 0, img.width, img.height);
        img.style.visibility = "hidden";
    };
</script>

